<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Master LEO v2.0</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#38bdf8">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4248/4248443.png">
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <header class="mobile-header">
        <div style="font-weight:bold; color:var(--accent); display:flex; gap:10px; align-items:center;">
            <i class="fas fa-database"></i> LEO v2.0
        </div>
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <div class="overlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-terminal"></i> LEO v2.0
        </div>
        
        <div class="sidebar-tabs">
            <button class="tab-btn active" onclick="switchTab('explorer')">
                <i class="fas fa-list"></i><span>Baza</span>
            </button>
            <button class="tab-btn" onclick="switchTab('docs')">
                <i class="fas fa-book"></i><span>Uputstvo</span>
            </button>
            <button class="tab-btn" onclick="switchTab('missions')">
                <i class="fas fa-trophy"></i><span>Misije</span>
            </button>
            <button class="tab-btn" onclick="switchTab('exercises')">
                <i class="fas fa-dumbbell"></i><span>Vežbe</span>
            </button>
        </div>

        <div id="tab-explorer" class="tab-content active">
            <div class="schema-container">
                <span class="schema-title">Tabele u memoriji</span>
                <ul id="table-list" class="table-list">
                    <li style="color: #64748b;"><i>Inicijalizacija...</i></li>
                </ul>
            </div>
            
            <div class="controls">
                <div class="file-ops">
                    <button onclick="saveDatabase()" class="secondary-btn" title="Sačuvaj Bazu">
                        <i class="fas fa-download"></i> Save
                    </button>
                    <label class="secondary-btn" title="Učitaj Bazu" style="margin-bottom: 0;">
                        <i class="fas fa-upload"></i> Load
                        <input type="file" id="db-upload" onchange="loadDatabase(this)" style="display: none;">
                    </label>
                </div>
                <button id="btn-load-demo" class="primary-btn" style="margin-top: 10px;" onclick="loadDemoData()">
                    <i class="fas fa-rotate-right"></i> Resetuj / Demo Podaci
                </button>
            </div>
        </div>

        <div id="tab-docs" class="tab-content">
            <div class="docs-container">
                
                <div class="doc-header">I. OSNOVE (CRUD)</div>
                
                <div class="doc-block">
                    <h3>SELECT (Čitanje)</h3>
                    <p>Prikazuje sve kolone iz tabele.</p>
                    <code>SELECT * FROM studenti;</code>
                    <p>Prikazuje samo specifične kolone.</p>
                    <code>SELECT ime, prezime FROM studenti;</code>
                </div>
                
                <div class="doc-block">
                    <h3>INSERT (Unos)</h3>
                    <p>Dodavanje novog studenta.</p>
                    <code>INSERT INTO studenti (id, ime, prezime, grad) VALUES (5, 'Vuk', 'Vukovic', 'Kragujevac');</code>
                </div>

                <div class="doc-block">
                    <h3>UPDATE (Izmena)</h3>
                    <p>Menja podatke (npr. grad) za određenog studenta.</p>
                    <code>UPDATE studenti SET grad = 'Subotica' WHERE ime = 'Marko';</code>
                </div>

                <div class="doc-block">
                    <h3>DELETE (Brisanje)</h3>
                    <p>Briše studenta sa ID-jem 5.</p>
                    <code>DELETE FROM studenti WHERE id = 5;</code>
                </div>

                <div class="doc-header">II. FILTRIRANJE I SORTIRANJE</div>

                <div class="doc-block">
                    <h3>WHERE (Uslov)</h3>
                    <p>Traži studente samo iz Beograda.</p>
                    <code>SELECT * FROM studenti WHERE grad = 'Beograd';</code>
                </div>

                <div class="doc-block">
                    <h3>AND / OR (Logika)</h3>
                    <p>Kombinovanje više uslova.</p>
                    <code>SELECT * FROM predmeti WHERE espb > 5 AND naziv = 'Baze Podataka';</code>
                </div>

                <div class="doc-block">
                    <h3>ORDER BY (Sortiranje)</h3>
                    <p>Sortiraj studente po imenu (A-Z).</p>
                    <code>SELECT * FROM studenti ORDER BY ime ASC;</code>
                    <p>Sortiraj ocene od najveće ka najmanjoj.</p>
                    <code>SELECT * FROM ocene ORDER BY ocena DESC;</code>
                </div>

                <div class="doc-header">III. MATEMATIKA (AGREGACIJA)</div>

                <div class="doc-block">
                    <h3>COUNT (Brojanje)</h3>
                    <p>Koliko ukupno ima studenata?</p>
                    <code>SELECT COUNT(*) FROM studenti;</code>
                </div>

                <div class="doc-block">
                    <h3>AVG (Prosek)</h3>
                    <p>Izračunaj prosečnu ocenu svih studenata.</p>
                    <code>SELECT AVG(ocena) FROM ocene;</code>
                </div>

                <div class="doc-block">
                    <h3>MAX / MIN</h3>
                    <p>Najveća i najmanja ocena.</p>
                    <code>SELECT MAX(ocena), MIN(ocena) FROM ocene;</code>
                </div>

                <div class="doc-header">IV. NAPREDNO (RELACIJE)</div>

                <div class="doc-block">
                    <h3>JOIN (Spajanje)</h3>
                    <p>Povezuje studente sa njihovim ocenama (ključni koncept!).</p>
                    <code>SELECT studenti.ime, ocene.ocena FROM studenti JOIN ocene ON studenti.id = ocene.ucenik_id;</code>
                </div>

                <div class="doc-block">
                    <h3>LIKE (Pretraga teksta)</h3>
                    <p>Pronađi studente čije ime počinje na 'M'.</p>
                    <code>SELECT * FROM studenti WHERE ime LIKE 'M%';</code>
                </div>

            </div>
        </div>

        <div id="tab-missions" class="tab-content">
            <div class="missions-container">
                <div class="mission-header">
                    <h3>Trenutni Zadatak</h3>
                    <span id="level-badge" class="badge">Level 1</span>
                </div>
                <p id="mission-desc" class="mission-text">Učitavanje misija...</p>
                <div class="mission-status">
                    Status: <span id="mission-status-text">Na čekanju</span>
                </div>
                <button onclick="checkSolution()" class="primary-btn success-btn">
                    <i class="fas fa-play"></i> Proveri Rešenje
                </button>
                <hr class="separator">
                <div class="level-list" id="level-list"></div>
            </div>
        </div>

        <div id="tab-exercises" class="tab-content">
            <div class="docs-container">
                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 6px; margin-bottom: 20px; border: 1px solid var(--success);">
                    <i class="fas fa-car"></i> <strong>PROJEKAT: AUTO PLAC</strong><br>
                    <span style="font-size: 0.85rem; color: #cbd5e1;">Izgradićemo kompletan sistem za prodaju automobila od nule. Ne trebaju ti demo podaci. Ti si arhitekta baze!</span>
                </div>

                <div class="doc-header">1. KORAK: ARHITEKTURA (CREATE)</div>
                <div class="doc-block">
                    <p><strong>Zadatak:</strong> Otvoriš auto plac. Prvo ti treba "sveska" (tabela) gde ćeš pisati automobile.</p>
                    <p style="color: var(--text-muted); font-size: 0.8rem;">
                        Kreiraj tabelu <code>automobili</code> koja ima:<br>
                        - <code>id</code> (broj)<br>
                        - <code>marka</code> (tekst)<br>
                        - <code>model</code> (tekst)<br>
                        - <code>cena</code> (broj)<br>
                        - <code>status</code> (tekst - npr. 'Na prodaju')
                    </p>
                    <code style="border-left: 3px solid var(--accent); color: #e2e8f0; display: block; white-space: pre-wrap;">
CREATE TABLE automobili (
    id INTEGER PRIMARY KEY,
    marka TEXT,
    model TEXT,
    cena INTEGER,
    status TEXT
);
                    </code>
                </div>

                <div class="doc-header">2. KORAK: PUNJENJE LAGERA (INSERT)</div>
                <div class="doc-block">
                    <p><strong>Zadatak:</strong> Stigli su prvi automobili na plac. Ubaci ih u sistem.</p>
                    <p style="color: var(--text-muted); font-size: 0.8rem;">
                        Unosimo 3 automobila odjednom. Prepiši ovaj kod pažljivo.
                    </p>
                    <code style="border-left: 3px solid var(--accent); color: #e2e8f0; display: block; white-space: pre-wrap;">
INSERT INTO automobili VALUES 
(1, 'BMW', 'X5', 15000, 'Na prodaju'),
(2, 'Audi', 'A4', 8500, 'Na prodaju'),
(3, 'Fiat', 'Punto', 2000, 'Na prodaju');
                    </code>
                    <p style="margin-top:5px; font-size: 0.8rem;"><i>*Proveri unos sa: <code>SELECT * FROM automobili;</code></i></p>
                </div>

                <div class="doc-header">3. KORAK: UPITI KUPACA (SELECT)</div>
                <div class="doc-block">
                    <p><strong>Zadatak:</strong> Došao je kupac i pita: "Imate li nešto jeftinije od 9000 evra?"</p>
                    <code style="border-left: 3px solid var(--accent); color: #e2e8f0; display: block; white-space: pre-wrap;">
SELECT * FROM automobili 
WHERE cena < 9000;
                    </code>
                </div>

                <div class="doc-header">4. KORAK: PRODAJA (UPDATE)</div>
                <div class="doc-block">
                    <p><strong>Zadatak:</strong> Čestitamo! Prodao si Audi (ID 2). Promeni mu status u 'PRODATO'.</p>
                    <p style="color: var(--text-muted); font-size: 0.8rem;">
                        Koristimo UPDATE da izmenimo postojeći podatak.
                    </p>
                    <code style="border-left: 3px solid var(--accent); color: #e2e8f0; display: block; white-space: pre-wrap;">
UPDATE automobili 
SET status = 'PRODATO' 
WHERE id = 2;
                    </code>
                    <p style="margin-top:5px; font-size: 0.8rem;"><i>*Proveri promenu: <code>SELECT * FROM automobili;</code></i></p>
                </div>

                <div class="doc-header">5. KORAK: INFLACIJA (ADVANCED UPDATE)</div>
                <div class="doc-block">
                    <p><strong>Zadatak:</strong> Cene su skočile. Podigni cenu svim automobilima koji još nisu prodati za 10%.</p>
                    <p style="color: var(--text-muted); font-size: 0.8rem;">
                        Matematika u SQL-u: <code>cena * 1.1</code>
                    </p>
                    <code style="border-left: 3px solid var(--accent); color: #e2e8f0; display: block; white-space: pre-wrap;">
UPDATE automobili 
SET cena = cena * 1.1 
WHERE status = 'Na prodaju';
                    </code>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div id="terminal-container"></div>
        
        <div id="snippet-container" class="snippet-bar"></div>
        
        <footer class="status-bar">
            <span id="status-text"><i class="fas fa-circle-notch fa-spin"></i> Učitavanje...</span>
            <span id="exec-timer">Ready</span>
        </footer>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    
    <script src="app.js"></script>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            setTimeout(() => { window.dispatchEvent(new Event('resize')); }, 350);
        }

        function switchTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            // 1. Resetuj sadržaje i pokreni animaciju iznova
            contents.forEach(el => {
                el.classList.remove('active');
                el.style.animation = 'none';
                el.offsetHeight; /* trigger reflow */
                el.style.animation = null; 
            });
            
            buttons.forEach(el => el.classList.remove('active'));

            // 2. Aktiviraj traženi tab
            const targetTab = document.getElementById(`tab-${tabName}`);
            if (targetTab) targetTab.classList.add('active');

            // 3. Obeleži aktivno dugme
            const tabs = ['explorer', 'docs', 'missions', 'exercises'];
            const index = tabs.indexOf(tabName);
            if (index !== -1) {
                buttons[index].classList.add('active');
            }
            
            // 4. Mobilna automatizacija
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                if (sidebar.classList.contains('active')) {
                    toggleSidebar();
                }
            }
        }

        // PWA Registracija
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(() => console.log("PWA: Service Worker Registrovan"));
        }
    </script>
</body>
</html>
